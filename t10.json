{"success":true,"thread":{"id":"PRRT_kwDORLmHoc5uXVmM","isResolved":false,"path":".agent/skills/gh-projects/scripts/lib/commands.js","line":908,"author":"devin-ai-integration","category":"ANALYSIS","body":"<!-- devin-review-comment {\"id\": \"ANALYSIS_pr-review-job-1aebd35219574709b7d5d1ec5d6c8bbe_0005\", \"file_path\": \".agent/skills/gh-projects/scripts/lib/commands.js\", \"start_line\": 906, \"end_line\": 908, \"side\": \"RIGHT\"} -->\n\nüö© **cmdShip uses `--head HEAD` literal instead of the branch name for PR lookup**\n\nIn the error handler for `cmdShip` at `commands.js:906`, when a PR already exists, the code tries to find it with:\n```js\nconst existingPrRaw = gh(`pr list --head HEAD --json url,number`);\n```\n\nThe `--head HEAD` flag passes the literal string `HEAD` as the branch name filter, not the resolved branch ref. The `gh pr list --head` flag expects a branch name like `feat/my-feature`, not the git ref `HEAD`. This means the PR lookup will likely return an empty array (no match), and the code will fall through to the generic \"PR Already Exists\" message at line 916-917 instead of returning the actual PR URL.\n\nThe fix would be to resolve the current branch name first (e.g., via `runGit('rev-parse --abbrev-ref HEAD')`) and pass that to `--head`.\n\n<!-- devin-review-badge-begin -->\n<a href=\"https://app.devin.ai/review/lofi-monk/lofipulse/pull/40\" target=\"_blank\">\n  <picture>\n    <source media=\"(prefers-color-scheme: dark)\" srcset=\"https://static.devin.ai/assets/gh-open-in-devin-review-dark.svg?v=1\">\n    <img src=\"https://static.devin.ai/assets/gh-open-in-devin-review-light.svg?v=1\" alt=\"Open in Devin Review\">\n  </picture>\n</a>\n<!-- devin-review-badge-end -->\n\n---\n*Was this helpful? React with üëç or üëé to provide feedback.*","code_snippet":"903: \r\n904:   } catch (err) {\r\n905:     // Handle \"PR already exists\" gracefully\r\n906:     if (err.message && err.message.includes('already exists')) {\r\n907:        // Try to find the existing PR URL\r\n908:        const existingPrRaw = gh(`pr list --head HEAD --json url,number`);\r\n909:        if (existingPrRaw) {\r\n910:          try {\r\n911:            const existingPr = JSON.parse(existingPrRaw)[0];\r\n912:            if (jsonMode) console.log(JSON.stringify({ success: true, prNumber: existingPr.number, url: existingPr.url, status: \"PR Already Exists\" }));\r\n913:            else console.log(`PR already exists: ${existingPr.url}`);\r","comments":[{"author":{"login":"devin-ai-integration"},"body":"<!-- devin-review-comment {\"id\": \"ANALYSIS_pr-review-job-1aebd35219574709b7d5d1ec5d6c8bbe_0005\", \"file_path\": \".agent/skills/gh-projects/scripts/lib/commands.js\", \"start_line\": 906, \"end_line\": 908, \"side\": \"RIGHT\"} -->\n\nüö© **cmdShip uses `--head HEAD` literal instead of the branch name for PR lookup**\n\nIn the error handler for `cmdShip` at `commands.js:906`, when a PR already exists, the code tries to find it with:\n```js\nconst existingPrRaw = gh(`pr list --head HEAD --json url,number`);\n```\n\nThe `--head HEAD` flag passes the literal string `HEAD` as the branch name filter, not the resolved branch ref. The `gh pr list --head` flag expects a branch name like `feat/my-feature`, not the git ref `HEAD`. This means the PR lookup will likely return an empty array (no match), and the code will fall through to the generic \"PR Already Exists\" message at line 916-917 instead of returning the actual PR URL.\n\nThe fix would be to resolve the current branch name first (e.g., via `runGit('rev-parse --abbrev-ref HEAD')`) and pass that to `--head`.\n\n<!-- devin-review-badge-begin -->\n<a href=\"https://app.devin.ai/review/lofi-monk/lofipulse/pull/40\" target=\"_blank\">\n  <picture>\n    <source media=\"(prefers-color-scheme: dark)\" srcset=\"https://static.devin.ai/assets/gh-open-in-devin-review-dark.svg?v=1\">\n    <img src=\"https://static.devin.ai/assets/gh-open-in-devin-review-light.svg?v=1\" alt=\"Open in Devin Review\">\n  </picture>\n</a>\n<!-- devin-review-badge-end -->\n\n---\n*Was this helpful? React with üëç or üëé to provide feedback.*","createdAt":"2026-02-13T00:25:18Z"}]}}
