{"success":true,"thread":{"id":"PRRT_kwDORLmHoc5uXVdP","isResolved":false,"path":".agent/skills/gh-projects/scripts/lib/commands.js","line":42,"author":"devin-ai-integration","category":"BUG","body":"<!-- devin-review-comment {\"id\": \"BUG_pr-review-job-1aebd35219574709b7d5d1ec5d6c8bbe_0002\", \"file_path\": \".agent/skills/gh-projects/scripts/lib/commands.js\", \"start_line\": 30, \"end_line\": 42, \"side\": \"RIGHT\"} -->\n\nüî¥ **Cache includes mutable items list causing stale item lookups in cmdSet and cmdGroom**\n\n`fetchProjectData` caches the entire project response (including `items.nodes`) for 10 minutes. `cmdSet` and `cmdGroom` use the cached items list to look up issues by number, so recently added issues won't be found.\n\n<details>\n<summary>Root Cause</summary>\n\nThe cache at `.agent/skills/gh-projects/scripts/lib/commands.js:30-42` stores the full project data including items. When `cmdAdd` adds a new issue to the project, the cache is not invalidated. A subsequent `cmdSet` or `cmdGroom` call within 10 minutes will use the stale cache, which doesn't contain the newly added item.\n\nFor example, this common workflow will fail:\n```bash\nnode projects.js --add 42\nnode projects.js --set --issue 42 --field \"Status\" --value \"In progress\"\n```\n\nThe second command calls `fetchProjectData` which returns the cached data from before issue #42 was added. The lookup at `commands.js:302` (`projectData.items.nodes.find(n => n.content?.number === issueNumber)`) returns `undefined`, and the command exits with \"Issue #42 not on board.\"\n\nSimilarly, `cmdGroom` at line 407 has the same problem.\n\nThe cache is appropriate for field schema (which rarely changes), but not for the items list (which changes on every `--add`).\n\n**Impact:** `--set` and `--groom` commands fail for any issue added within the last 10 minutes, which is the most common workflow (add then configure).\n\n</details>\n\n<details>\n<summary>Prompt for agents</summary>\n\n```\nThe fetchProjectData cache in .agent/skills/gh-projects/scripts/lib/commands.js stores the entire project response including items.nodes, but cmdSet and cmdGroom use items.nodes to look up issues by number. When an issue is added via cmdAdd, the cache becomes stale.\n\nTwo possible fixes:\n\n1. Only cache the fields schema (which rarely changes), not the items list. Split the cache to only store projectData.fields and projectData.id, and always fetch items fresh.\n\n2. Invalidate the cache after mutations that change the items list. Add a cache invalidation call in cmdAdd (after successfully adding an item) that deletes the cache file. For example, add an invalidateCache() helper that removes CACHE_FILE, and call it at the end of cmdAdd.\n```\n\n</details>\n\n<!-- devin-review-badge-begin -->\n<a href=\"https://app.devin.ai/review/lofi-monk/lofipulse/pull/40\" target=\"_blank\">\n  <picture>\n    <source media=\"(prefers-color-scheme: dark)\" srcset=\"https://static.devin.ai/assets/gh-open-in-devin-review-dark.svg?v=1\">\n    <img src=\"https://static.devin.ai/assets/gh-open-in-devin-review-light.svg?v=1\" alt=\"Open in Devin Review\">\n  </picture>\n</a>\n<!-- devin-review-badge-end -->\n\n---\n*Was this helpful? React with üëç or üëé to provide feedback.*","code_snippet":"37:         return JSON.parse(fs.readFileSync(CACHE_FILE, 'utf8'));\r\n38:       }\r\n39:     }\r\n40:   } catch (e) {\r\n41:     // Fallback to fresh fetch on cache error\r\n42:   }\r\n43: \r\n44:   const query = `\r\n45:     query($owner: String!, $number: Int!) {\r\n46:       user(login: $owner) {\r\n47:         projectV2(number: $number) {\r","comments":[{"author":{"login":"devin-ai-integration"},"body":"<!-- devin-review-comment {\"id\": \"BUG_pr-review-job-1aebd35219574709b7d5d1ec5d6c8bbe_0002\", \"file_path\": \".agent/skills/gh-projects/scripts/lib/commands.js\", \"start_line\": 30, \"end_line\": 42, \"side\": \"RIGHT\"} -->\n\nüî¥ **Cache includes mutable items list causing stale item lookups in cmdSet and cmdGroom**\n\n`fetchProjectData` caches the entire project response (including `items.nodes`) for 10 minutes. `cmdSet` and `cmdGroom` use the cached items list to look up issues by number, so recently added issues won't be found.\n\n<details>\n<summary>Root Cause</summary>\n\nThe cache at `.agent/skills/gh-projects/scripts/lib/commands.js:30-42` stores the full project data including items. When `cmdAdd` adds a new issue to the project, the cache is not invalidated. A subsequent `cmdSet` or `cmdGroom` call within 10 minutes will use the stale cache, which doesn't contain the newly added item.\n\nFor example, this common workflow will fail:\n```bash\nnode projects.js --add 42\nnode projects.js --set --issue 42 --field \"Status\" --value \"In progress\"\n```\n\nThe second command calls `fetchProjectData` which returns the cached data from before issue #42 was added. The lookup at `commands.js:302` (`projectData.items.nodes.find(n => n.content?.number === issueNumber)`) returns `undefined`, and the command exits with \"Issue #42 not on board.\"\n\nSimilarly, `cmdGroom` at line 407 has the same problem.\n\nThe cache is appropriate for field schema (which rarely changes), but not for the items list (which changes on every `--add`).\n\n**Impact:** `--set` and `--groom` commands fail for any issue added within the last 10 minutes, which is the most common workflow (add then configure).\n\n</details>\n\n<details>\n<summary>Prompt for agents</summary>\n\n```\nThe fetchProjectData cache in .agent/skills/gh-projects/scripts/lib/commands.js stores the entire project response including items.nodes, but cmdSet and cmdGroom use items.nodes to look up issues by number. When an issue is added via cmdAdd, the cache becomes stale.\n\nTwo possible fixes:\n\n1. Only cache the fields schema (which rarely changes), not the items list. Split the cache to only store projectData.fields and projectData.id, and always fetch items fresh.\n\n2. Invalidate the cache after mutations that change the items list. Add a cache invalidation call in cmdAdd (after successfully adding an item) that deletes the cache file. For example, add an invalidateCache() helper that removes CACHE_FILE, and call it at the end of cmdAdd.\n```\n\n</details>\n\n<!-- devin-review-badge-begin -->\n<a href=\"https://app.devin.ai/review/lofi-monk/lofipulse/pull/40\" target=\"_blank\">\n  <picture>\n    <source media=\"(prefers-color-scheme: dark)\" srcset=\"https://static.devin.ai/assets/gh-open-in-devin-review-dark.svg?v=1\">\n    <img src=\"https://static.devin.ai/assets/gh-open-in-devin-review-light.svg?v=1\" alt=\"Open in Devin Review\">\n  </picture>\n</a>\n<!-- devin-review-badge-end -->\n\n---\n*Was this helpful? React with üëç or üëé to provide feedback.*","createdAt":"2026-02-13T00:25:10Z"}]}}
